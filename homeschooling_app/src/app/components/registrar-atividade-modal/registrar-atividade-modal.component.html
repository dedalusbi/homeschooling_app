<ion-header class="ion-no-border">
  <ion-toolbar class="bg-white rounded-t-xl">
    <div class="flex justify-between items-start p-2">
      <div>
        <h2 class="text-lg font-bold text-texto-profundo">Registrar atividade</h2>
        <p class="text-sm text-texto-suave">{{aula.subject_name}} - {{aula.start_time | slice:0:5}}</p>
        <p class="text-sm text-texto-suave">{{dataOcorrencia | date:'dd/MM/yyyy'}}</p>
      </div>
      <ion-button fill="clear" (click)="dismiss(null)" class="text-texto-suave -mr-2 -mt-2">
        <ion-icon name="close" slot="icon-only" class="text-xl"></ion-icon>
      </ion-button>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content class="[--background:white]">

  <div class="p-4 space-y-6">

    <div>
      <ion-label class="text-sm text-texto-profundo font-medium block mb-2">Status da Aula</ion-label>
      <div class="flex gap-3">
        <div class="flex-1 cursor-pointer rounded-lg border-2 transition-all duration-200 h-12 flex items-center justify-center gap-2"
              [class.bg-verde-crescimento]="status === 'completed'"
              [class.border-verde-crescimento]="status === 'completed'"
              [class.text-white]="status === 'completed'"
              [class.bg-gray-100]="status !== 'completed'"
              [class.border-transparent]="status !== 'completed'"
              [class.text-texto-suave]="status !== 'completed'"
              (click)="setStatus('completed')">
          <ion-icon name="checkmark"></ion-icon>
          <span class="font-medium">Concluída</span>
        </div>

        <div class="flex-1 cursor-pointer rounded-lg border-2 transition-all duration-200 h-12 flex items-center justify-center gap-2"
              [class.bg-gray-200]="status === 'missed'"
              [class.border-gray-300]="status === 'missed'"
              [class.text-texto-profundo]="status === 'missed'"
              [class.bg-gray-100]="status !== 'missed'"
              [class.border-transparent]="status !== 'missed'"
              [class.text-texto-suave]="status !== 'missed'"
              (click)="setStatus('missed')">
          <ion-icon name="close"></ion-icon>
          <span class="font-medium">Não Realizada</span>
        </div>

      </div>
    </div>

    <div>
      <ion-label class="text-sm text-texto-profundo font-medium block mb-2">Anotações da aula</ion-label>
      <div class="border border-linha-sutil rounded-lg p-2 bg-white">
        <ion-textarea
          [(ngModel)]="notes"
          placeholder="Descreva como foi a aula, dificuldades encontradas, pontos positivos..."
          rows="5"
          class="text-sm"
          [autoGrow]="true">
        </ion-textarea>
      </div>
    </div>


    <div>
      <ion-label class="text-sm text-texto-profundo font-medium block mb-2">Fotos e Documentos</ion-label>

      <input
        type="file"
        #fileInput
        (change)="onFileSelected($event)"
        style="display: none;"
        accept="image/*,application/pdf"
        multiple
      />

      
      <div class="flex gap-2 overflow-x-auto pb-2">
        <div class="w-20 h-20 rounded-lg border-2 border-dashed border-linha-sutil flex flex-col items-center justify-center text-texto-suave cursor-pointer bg-gray-50 hover:bg-gray-100"
          (click)="fileInput.click()">
          <ion-spinner *ngIf="isUploading" name="crescent"></ion-spinner>
          <div *ngIf="!isUploading" class="flex flex-col items-center">
            <ion-icon name="add-circle" class="text-2xl mb-1"></ion-icon>
            <span class="text-[10px]">Adicionar</span>
          </div>          
        </div>

        <div *ngFor="let att of attachments" class="relative w-20 h-20 flex-shrink-0">
          <ng-container *ngIf="isImage(att)">
            <img [src]="att.file_url" class="w-full h-full object-cover rounded-lg border border-linha-sutil"
                  (click)="openImage(att.file_url)">
          </ng-container>
          <ng-container *ngIf="!isImage(att)">
            <div *ngIf="!att.file_type.startsWith('image')" class="w-full h-full flex items-center justify-center bg-gray-100 rounded-lg border border-linha-sutil text-texto-profundo"
                        (click)="openImage(att.file_url)">
              <ion-icon name="document-text" class="text-2xl"></ion-icon>
              <span class="text-[8px] w-full truncate text-center">{{att.file_name}}</span>
            </div>
          </ng-container>
          
        </div>

      </div>
    </div>

  </div>


  <div class="ion-no-border p-4 bg-white">
    <ion-button expand="block" shape="round" class="h-12 text-base normal-case [--background:theme(colors.azul-sereno)] text-white" (click)="saveLog()">

      <ion-icon name="save" slot="start"></ion-icon>
      Salvar Registro
    </ion-button>

  </div>

</ion-content>

